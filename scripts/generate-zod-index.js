import chalk from "chalk";
import fs from "fs";
import path from "path/posix";

export function generateZodIndex(zodDir, files) {
	let indexTS = `// This file was generated by scripts/generate-zod-index.js at ${new Date().toUTCString()}\n`;
	let lastDir;
	for (const file of files) {
		if (!lastDir || lastDir !== path.dirname(file)) {
			lastDir = path.dirname(file);
			indexTS += `\n// ${path.dirname(file).replace(/^.*\//, "")}\n`;
		}
		indexTS += `export { ${path.basename(file, ".ts")} } from "./${file.replace(/\.ts$/, "")}.js";\n`;
	}

	fs.writeFileSync(`${zodDir}/_index.ts`, indexTS);
	console.log(chalk.green("Index file generated"));
	return true;
}
